<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="leaflet.css">
        <style type="text/css">
            #map {
                position: absolute;
                left: 0;
                right: 0;
                top: 0;
                bottom: 0;
            }
            #filter-control {
                background-image: url(images/filter-2x.png);
                background-size: 26px 26px;
            }
        </style>
    </head>
    <body>
         <div id="map"/>
         <script src="leaflet.js"></script>
         <script src="leaflet.ajax.min.js"></script>
          <script src="L.TileLayer.Kartverket.min.js"></script>
          <script type="text/javascript">
            (function() {
                'use strict';

                var map = L.map('map').setView([65.5, 17.0], 4);

                var i, layer;
                var layers = L.tileLayer.kartverket.getLayers();

                var baseLayers = {
                  'Norway: Kartverket Topography': 'topo2',
                  'Europe: Kartverket Europa': 'europa',
                  'Norway: Kartverket Light': 'norges_grunnkart',
                  'Europe: Kartverket Light': 'egk'
                }
                for (i = 0; i < layers.length; i++) {
                    layer = layers[i];
                    for (var key in baseLayers) {
                      if (baseLayers[key]==layer) {
                        baseLayers[key] = L.tileLayer.kartverket(layer);
                      }
                    }
                }
                baseLayers['Norway: Kartverket Topography'].addTo(map);
                L.control.layers(baseLayers).addTo(map);

                var onEachFeature_all = function (feature, layer) {
                                 layer.on('mouseover', function() {
                                     this.setStyle({
                                       'weight': 4,
                                       'fillOpacity': 0.25
                                     })})
                                 layer.on('mouseout', function() {
                                     this.setStyle({
                                       'weight': 2,
                                       'fillOpacity': feature.properties['fillOpacity']
                                     })})

                                 var source=feature.properties['source_href'];
                                 layer.bindPopup(
                                     '<h2>'+feature.properties['name']+'</h2><br />'+
                                     'Class: '+feature.properties['class']+'<br />'+
                                     'Ceiling: '+feature.properties['to (m amsl)']+'m above MSL<br />'+
                                     'Floor: '+feature.properties['from (m amsl)']+'m above MSL<br />'+
                                     '<a href="'+source+'">Kilde (PDF)</a><br />'
                                 );
                };

                var style_all = function(feature) {
                    return feature.properties;
                };

                var filter_all = function(key, search) {
                    return function(feature) {
                        for (var term in search) { 
                            if (feature.properties[key].indexOf(term) > -1) {
                                return true;
                            }
                        }
                        return false;
                    }
                };

                var overLayers = {
                  "Norwegian airspace (2017-07-07)": new L.GeoJSON.AJAX("https://rawgit.com/relet/pg-xc/master/geojson/luftrom.geojson", { onEachFeature: onEachFeature_all, style: style_all }),
                  " - CTA": new L.GeoJSON.AJAX("https://rawgit.com/relet/pg-xc/master/geojson/luftrom.geojson", { onEachFeature: onEachFeature_all, style: style_all, filter: filter_all('name',['CTA']) }),
                  " - TMA": new L.GeoJSON.AJAX("https://rawgit.com/relet/pg-xc/master/geojson/luftrom.geojson", { onEachFeature: onEachFeature_all, style: style_all, filter: filter_all('name',['TMA']) }),
                  " - CTR/TIA/TIZ": new L.GeoJSON.AJAX("https://rawgit.com/relet/pg-xc/master/geojson/luftrom.geojson", { onEachFeature: onEachFeature_all, style: style_all, filter: filter_all('name',['CTR','TIA','TIZ']) }),
                  " - Danger/Restricted": new L.GeoJSON.AJAX("https://rawgit.com/relet/pg-xc/master/geojson/luftrom.geojson", { onEachFeature: onEachFeature_all, style: style_all, filter: filter_all('class',['R']) }),
                  " - Air sport": new L.GeoJSON.AJAX("https://rawgit.com/relet/pg-xc/master/geojson/luftrom.geojson", { onEachFeature: onEachFeature_all, style: style_all, filter: filter_all('class',['Luftsport']) }),
                };

                overLayers["Norwegian airspace (2017-07-07)"].addTo(map);
                filter_control = L.control.layers(overLayers);
                filter_control.id = 'filter-control';
                filter_control.addTo(map);


            }());
          </script>

</body></html>
